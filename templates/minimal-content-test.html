<!DOCTYPE html>
<html>
<head>
    <title>Minimal Content Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #e0e0e0; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        .chart-container { 
            background: #2a2a2a; 
            border: 1px solid #555; 
            border-radius: 5px; 
            padding: 15px; 
            min-height: 300px; 
            margin: 20px 0;
        }
        .chart-container h3 { 
            color: #fff; 
            margin-top: 0; 
            margin-bottom: 15px; 
            font-size: 1.1em; 
            text-align: center; 
        }
        #test-chart { 
            background: #333; 
            border: 1px solid yellow; 
        }
        .chart-selector {
            margin: 20px 0;
            text-align: center;
        }
        .chart-selector select {
            background: #2a2a2a;
            border: 1px solid #555;
            color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            font-size: 16px;
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin: 20px 0; 
        }
        .metric-section { 
            background: #1a1a1a; 
            border: 1px solid #444; 
            padding: 15px; 
            border-radius: 5px; 
        }
        .metric-section h3 { 
            margin-top: 0; 
            color: #fff; 
            border-bottom: 1px solid #444; 
            padding-bottom: 8px; 
        }
        .metric-item { 
            margin: 8px 0; 
            color: #e0e0e0; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minimal Content Test</h1>
        
        <div class="metrics-grid">
            <div class="metric-section">
                <h3>Asset Metrics</h3>
                <div class="metric-item">Price USD: $1.2345</div>
                <div class="metric-item">FDV USD: $1,234,567</div>
                <div class="metric-item">Market Cap USD: $1,234,567</div>
            </div>
            
            <div class="metric-section">
                <h3>Yield Metrics</h3>
                <div class="metric-item">24h Fees: $1,234</div>
                <div class="metric-item">Daily Yield: 0.123%</div>
                <div class="metric-item">APY Simple: 12.34%</div>
            </div>
        </div>
        
        <div class="chart-selector">
            <label for="chartType">Select Chart: </label>
            <select id="chartType" onchange="loadSelectedChart()">
                <option value="portfolio">Portfolio Composition</option>
                <option value="price">Price Trend</option>
            </select>
        </div>
        
        <div class="chart-container">
            <h3 id="chartTitle">Portfolio Composition</h3>
            <div id="test-chart" style="width: 100%; height: 250px;">
                <div style="text-align: center; padding: 50px; color: #888;">
                    Loading chart...
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
        setTimeout(function() {
            console.log('Starting minimal content test...');
            loadSelectedChart();
        }, 1000);
        
        function loadSelectedChart() {
            const chartType = document.getElementById('chartType').value;
            const chartTitle = document.getElementById('chartTitle');
            const chartElement = document.getElementById('test-chart');
            
            // Update title
            chartTitle.textContent = chartType === 'portfolio' ? 'Portfolio Composition' : 'Price Trend';
            
            // Clear previous chart
            chartElement.innerHTML = '';
            
            if (chartType === 'portfolio') {
                loadPortfolioChart();
            } else {
                loadPriceChart();
            }
        }
        
        async function loadPortfolioChart() {
            try {
                const response = await fetch('/api/portfolio-composition');
                const data = await response.json();
                
                if (data.composition && data.composition.length > 0) {
                    const labels = data.composition.map(item => item.symbol);
                    const values = data.composition.map(item => item.value);
                    const text = data.composition.map(item => 
                        `${item.symbol}<br>${item.percentage.toFixed(1)}%<br>$${item.value.toLocaleString()}`
                    );
                    
                    const plotData = [{
                        labels: labels,
                        values: values,
                        text: text,
                        textinfo: 'text',
                        hovertemplate: '<b>%{label}</b><br>Value: $%{value:,.0f}<br>Percentage: %{percent}<extra></extra>',
                        type: 'pie',
                        marker: {
                            colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'],
                            line: { color: '#fff', width: 2 }
                        }
                    }];
                    
                    const layout = {
                        title: {
                            text: 'Portfolio Composition by Asset',
                            font: { color: '#fff', size: 18 }
                        },
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        font: { color: '#e0e0e0', size: 12 },
                        showlegend: true,
                        legend: {
                            font: { color: '#e0e0e0', size: 12 },
                            orientation: 'h',
                            x: 0.5,
                            y: -0.1,
                            xanchor: 'center'
                        },
                        margin: { l: 50, r: 50, t: 50, b: 80 },
                        height: 350
                    };
                    
                    console.log('Rendering portfolio chart...');
                    Plotly.newPlot('test-chart', plotData, layout, {responsive: true, displayModeBar: false});
                    console.log('Portfolio chart rendered successfully');
                } else {
                    document.getElementById('test-chart').innerHTML = 'No portfolio data available';
                }
            } catch (error) {
                console.error('Error loading portfolio composition:', error);
                document.getElementById('test-chart').innerHTML = 'Error loading portfolio data';
            }
        }
        
        async function loadPriceChart() {
            try {
                const response = await fetch('/api/time-series');
                const data = await response.json();
                
                if (data.timestamps && data.timestamps.length > 0) {
                    const plotData = [{
                        x: data.timestamps,
                        y: data.price,
                        type: 'scatter',
                        mode: 'lines+markers',
                        line: { color: '#4ECDC4', width: 2 },
                        marker: { size: 4, color: '#4ECDC4' }
                    }];
                    
                    const layout = {
                        title: { text: 'Price (USD)', font: { color: '#fff', size: 16 } },
                        xaxis: { 
                            color: '#e0e0e0', 
                            gridcolor: '#444',
                            showgrid: true,
                            zeroline: false,
                            tickformat: '%m/%d %H:%M'
                        },
                        yaxis: { 
                            color: '#e0e0e0', 
                            gridcolor: '#444',
                            showgrid: true,
                            zeroline: false,
                            tickformat: '$.4f'
                        },
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        font: { color: '#e0e0e0', size: 12 },
                        margin: { l: 50, r: 50, t: 50, b: 50 },
                        showlegend: false
                    };
                    
                    console.log('Rendering price chart...');
                    Plotly.newPlot('test-chart', plotData, layout, {responsive: true, displayModeBar: false});
                    console.log('Price chart rendered successfully');
                } else {
                    document.getElementById('test-chart').innerHTML = 'No price data available';
                }
            } catch (error) {
                console.error('Error loading price data:', error);
                document.getElementById('test-chart').innerHTML = 'Error loading price data';
            }
        }
    </script>
</body>
</html>
